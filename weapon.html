<!doctype html>
<html lang="en" xmlns="">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>飞瘾犯了-武器</title>
</head>


<link href="css/bootstrap.min.css?v=202404021835" rel="stylesheet" type="text/css">
<link href="css/style.css?v=202404021835" rel="stylesheet" type="text/css">
<link href="css/font-awesome.css?v=4.4.0" rel="stylesheet">
<!-- Morris -->
<link href="css/plugins/morris/morris-0.4.3.min.css" rel="stylesheet">
<!-- Gritter -->
<link href="js/plugins/gritter/jquery.gritter.css" rel="stylesheet">
<link href="css/animate.css" rel="stylesheet">

<body class="gray-bg">
<div class="wrapper wrapper-content">
	<div class="row">
		<div class="col-sm-4">
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>武器专区</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					<div class="feed-activity-list">
						<div class="media-body ">
							<div class="row" weapon_list></div>
						</div>
					</div>
				</div>
			</div>
			<div class="ibox float-e-margins"></div>
		</div>

		<div class="col-sm-4">
			<div class="ibox float-e-margins">
				<div class="ibox float-e-margins">
					<div class="ibox-title">
						<h5>武器属性</h5>
						<div class="ibox-tools">
							<a class="collapse-link">
								<i class="fa fa-chevron-up"></i>
							</a>
						</div>
					</div>
					<div class="ibox-content">
						<div weapon-attributes></div>
					</div>
				</div>
			</div>

			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>武器操作台</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					<div class="feed-activity-list">
						<div class="feed-element">
							<div class="media-body ">
								<img alt="image" class="img-circle" src="img/items/syssysscrsmepro2.png">
								<button class="btn btn-success" weapon_up onclick="weapon_low_up()" >low7</button>
								<img alt="image" class="img-circle" src="img/items/syssysscrsmepro.png">
								<button class="btn btn-success" weapon_up onclick="weapon_up()" >防暴</button>
							</div>
						</div>
						<div class="feed-element">
							<div class="media-body ">
								<img alt="image" class="img-circle" src="img/items/genmatorichalcum02.png">
								<button class="btn btn-success" weapon_up  onclick="up_u_weapon()" >升U</button>
								<img alt="image" class="img-circle" src="img/items/scrollskillawake.png">
								<button class="btn btn-success" weapon_up onclick="wake_up()" >技唤</button>
							</div>
						</div>
						<div class="feed-element">
							<div class="media-body ">
								<img alt="image" class="img-circle" src="img/skills/asschemental.png">
								<button class="btn btn-success" attribute_up onclick="attribute_wake_up(0)" >智唤</button>
								<img alt="image" class="img-circle" src="img/skills/asscheheapup.png">
								<button class="btn btn-success" attribute_up onclick="attribute_wake_up(1)" >体唤</button>
							</div>
						</div>
						<div class="feed-element">
							<div class="media-body ">
								<img alt="image" class="img-circle" src="img/skills/asschebeefup.png">
								<button class="btn btn-success" attribute_up onclick="attribute_wake_up(2)" >力唤</button>
								<img alt="image" class="img-circle" src="img/skills/asschecannon.png">
								<button class="btn btn-success" attribute_up onclick="attribute_wake_up(3)" >敏唤</button>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="ibox float-e-margins"></div>
		</div>

		<div class="col-sm-4">
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>弹框</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					<div class="row hide" weapon_roll_div >
						<div class="col-xs-12" >
							<div class="image-frame" float_left>
								<div weapon_top_text>
									拾取分配
								</div>
								<div weapon_roll_text>
									<span>□</span><span>□</span><span>□</span><span>□</span>
									<span>□</span><span>□</span><span>□</span><span>□</span>
								</div>
								<div weapon_num_text>
									物品(1/1)
								</div>
								<img weapon_img src="img/weapon/卢萨卡之剑.png" alt="Weapon Image" />
								<div weapon_bottom_text></div>
								<div weapon_remark_text>
									为以上物品roll一个随机数，或者如果<br>
									你不感兴趣，点击略过。计时器结束<br>
									后，随机数字最高的玩家将获得该物<br>
									品
								</div>

								<div weapon_btn_text>
									<button onclick="previous_weapon()">上一个</button>
									<button style="margin-left: 30px;" onclick="next_weapon()">下一个</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>消息</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					<div class="feed-activity-list">
						<div class="feed-element">
							<div class="media-body ">
								<div class="row" txt_div></div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="ibox float-e-margins"></div>
		</div>
	</div>
</div>

<!-- 全局js -->
<script src="js/jquery.min.js?v=2.1.4"></script>
<script src="js/bootstrap.min.js?v=3.3.6"></script>
<script src="js/base.js?v=202404020006"></script>
<!-- 自定义js -->
<script src="js/content.js?v=1.0.0"></script>
<!-- jQuery UI -->
<script src="js/plugins/jquery-ui/jquery-ui.min.js"></script>

<script>
	$(document).ready(function() {
		//页面元素可移动
		WinMove();

		// 当页面加载完成后，给 body 元素添加自定义光标样式
		$('body').addClass('custom-cursor');

		$(data).each(function(i,obj){
			$("[weapon_list]").append(`
				<div class="col-xs-4" btn_weapon onclick="get_weapon_go(${obj.id})">
					<img src="${obj.imgUrl}" alt="${obj.name}">
				</div>
			`);
		});
	});

	function attribute_wake_up(num){
		const weaponObj = data.find(obj => obj.id === parseInt(weapon_index));
		//没有武器
		if(weaponObj == null){
			return;
		}

		$("[attribute_up]").attr("disabled",true);
		if(attribute_up_stop){
			attribute_up_stop = false;
			$("[attribute_up]").removeAttr("disabled");
			return ;
		}

		attribute_wake_up_go(num);
		setTimeout(function() {
			attribute_wake_up(num);
		}, 50); // 1000毫秒等于1秒
	}

	//属性唤醒
	function attribute_wake_up_go(num){
		if(now_attribute === "+4" && $("[attribute_now]").attr("attribute_now") === attribute_data[num].name){
			$("[max_msg]").remove();
			$("[txt_div]").prepend(`<div max_msg class="col-xs-12">已经是最大值了!</div>`);
			attribute_up_stop = true;
			return ;
		}

		let randomNum = Math.random().toFixed(2);
		let attribute_probability = 0;

		$("[attribute_span]").remove();

		for(let i=0 ; i < attribute_data[num].list.length ; i++) {
			const data = attribute_data[num].list[i];
			if (i > 0) {
				attribute_probability = parseFloat(data.probability) + parseFloat(attribute_probability);
			} else {
				attribute_probability = parseFloat(data.probability);
			}
			attribute_probability = attribute_probability.toFixed(2);

			//数字是否匹配
			if (randomNum < attribute_probability) {
				attribute_num++
				now_attribute = data.name;
				$("[job_span]").before(`
					<span attribute_span color_white>${attribute_data[num].name}${data.name}<br></span>
				`);

				$("[attribute_name]").html(`${attribute_data[num].name}的`);
				break;
			}
		}

		$("[txt_div]").html(`
			<div class="col-xs-12">2元/次</div>
			<div class="col-xs-12">你的钱包-${attribute_num*2}元</div>
			<div class="col-xs-12" attribute_now="${attribute_data[num].name}">${attribute_data[num].name}属性唤醒次数:${attribute_num}</div>
		`);
	}

	//升U
	function up_u_weapon(){
		// if(Number($("[weapon_up_lv]").attr("weapon_up_lv")) !== 10){
		// 	errorMsg("武器还没+10哦");
		// 	return;
		// }
		const weaponObj = data.find(obj => obj.id === parseInt(weapon_index));

		if(weaponObj == null){
			return;
		}

		$("[up_u_weapon_div]").remove();
		var arr = weaponObj.uList;
		var value1 = arr.splice(Math.floor(Math.random() * arr.length), 1)[0];
		var value2 = arr.splice(Math.floor(Math.random() * arr.length), 1)[0];

		var list = [];
		list.push(value1);
		list.push(value2);

		//还原数据
		arr.push(value1);
		arr.push(value2);

		let str = "<div up_u_weapon_div>";
		//组装属性值
		for(var i=0 ; i < list.length ; i++){
			var obj = list[i];
			var num = Math.floor(Math.random()*(obj.max-obj.min+1));
			var maxNum = obj.max;
			var minNum = obj.min;
			//最终计算出来的随机值
			var randomNum = obj.min + num;

			//缩进小数位
			maxNum = obj.fixed == null ? maxNum : (maxNum/obj.fixed);
			minNum = obj.fixed == null ? minNum : (minNum/obj.fixed);
			randomNum = obj.fixed == null ? randomNum : (randomNum/obj.fixed);

			//组装单位(例如 百分号)
			randomNum = randomNum+obj.cur;
			str +='<span style="color: #fffd43">'+ obj.name +'+' + randomNum + ' (' + minNum+'~'+maxNum+')'+obj.cur+'</span><br>';
		}

		str += "</div>";

		if($("[attribute_span]").length != 0){
			$("[attribute_span]").before(str);
		}else{
			$("[job_span]").before(str);
		}
	}

	//技能唤醒
	function wake_up(){
		if(wakeUpList == null){
			return ;
		}
		$("[wake_up]").remove();

		//随机数组中的值
		const wakeUp = wakeUpList[Math.floor(Math.random() * wakeUpList.length)];
		const percentage = wakeUp.item[Math.floor(Math.random() * wakeUp.item.length)];
		$("[weapon_description]").after('<div wake_up></br><span style="color: #fe0f7a;" >'+wakeUp.name+(wakeUp.name ==="治疗" ? '+' : ' 造成伤害+')+percentage+"%"+'</span></div>');
	}

	function weapon_up(){
		$("[weapon_up]").attr("disabled",true);
		if(weapon_up_stop){
			weapon_up_stop = false;
			$("[weapon_up]").removeAttr("disabled");
			return ;
		}
		if(Number($("[weapon_up_lv]").attr("weapon_up_lv")) !== 10){
			$("[txt_div]").html("");
		}

		weapon_up_go();
		setTimeout(function() {
			weapon_up();
		}, 50); // 1000毫秒等于1秒
	}
	function weapon_up_go(){
		//武器已经强化到+10啦
		if(Number($("[weapon_up_lv]").attr("weapon_up_lv")) === 10 || $("[weapon_up_lv]").length === 0){
			weapon_up_stop = true;
			return ;
		}
		weapon_up_num++;
		//初始化
		init_up();

		let str = '<hr>';
		// 生成一个0到1之间的随机数
		let randomNum = Math.random();
		//是否精炼成功
		if(randomNum <= probability){
			weapon_lv++;
			str+='<div class="col-xs-6" color_green>精炼+'+weapon_lv+'成功!<br></div>';

			if(weapon_lv !== 10){
				//成功后重置概率
				probability = upList[weapon_lv].probability;
			}
		}else {
			//获取强化精炼数据
			const upObj = upList[weapon_lv];
			//失败次数
			failure_num++;
			//失败累加基础强化概率
			probability = upObj.probability+probability;
			//成功概率不能大于1
			probability = probability >= 1 ? 1 : probability;
			str+="<div class='col-xs-6' color_red>精炼失败!<br></div>";
		}
		str+="<div class='col-xs-6'>当前成功率"+probability+"</div><hr>";
		//组装数据
		txt_div_prepend(str);
	}

	function weapon_low_up(){
		$("[weapon_up]").attr("disabled",true);
		if(weapon_low_up_stop){
			weapon_low_up_stop = false;
			$("[weapon_up]").removeAttr("disabled");
			return ;
		}
		if(Number($("[weapon_up_lv]").attr("weapon_up_lv")) !== 10){
			$("[txt_div]").html("");
		}

		weapon_low_up_go(low_num);
		setTimeout(function() {
			weapon_low_up();
		}, 50); // 1000毫秒等于1秒
	}

	function weapon_low_up_go(num){
		//武器已经强化到+10啦
		if(Number($("[weapon_up_lv]").attr("weapon_up_lv")) === 10 || $("[weapon_up_lv]").length === 0){
			weapon_low_up_stop=true;
			return ;
		}

		weapon_low_up_num++;

		//初始化
		init_up();

		let str = '<hr>';
		// 生成一个0到1之间的随机数
		let randomNum = Math.random();
		//是否精炼成功
		if(randomNum <= low_probability){
			//升级
			weapon_lv++;
			const now_weapon_lv = weapon_lv === 0 ? "" : ("+" + weapon_lv);
			str+='<div class="col-xs-6" color_green>low精炼'+now_weapon_lv+'成功!</div>';
		}else {
			//失败次数
			failure_num++;

			//+3以前失败不掉级
			if(weapon_lv > 3){
				//降级
				weapon_lv--;
				str+='<div class="col-xs-6" color_red>low精炼失败!掉级至+'+weapon_lv+'</div>';
			}else{
				str+='<div class="col-xs-6" color_red>low精炼失败!+3以前失败不掉级</div>';
			}
		}
		str+='<div class="col-xs-6">当前成功率'+low_probability+'</div><hr>';
		//组装数据
		txt_div_prepend(str);

		if(Number($("[weapon_up_lv]").attr("weapon_up_lv")) === num){
			weapon_low_up_stop=true;
		}
	}

	function txt_div_prepend(str){
		$("[weapon_up_lv]").html(weapon_lv === 0 ? "" : ("+"+weapon_lv));
		$("[weapon_up_lv]").attr("weapon_up_lv",weapon_lv);
		//获取强化精炼数据
		const upObj = upList[weapon_lv === 10 ? 9 : weapon_lv];

		str+=`
			<div class="col-xs-6">强化总次数:${up_num}</div><div class="col-xs-6">失败次数:${failure_num}</div>
			<div class="col-xs-6">low卷强化次数:${weapon_low_up_num}</div><div class="col-xs-6">防暴卷强化次数:${weapon_up_num}</div>
			<hr>
			<div class="col-xs-6">总共消耗</div><div class="col-xs-6">本次消耗</div>
			<div class="col-xs-6">金币:${gold}<br>黄矿:${yellow}<br>绿矿:${green}<br>四点骰子:${four_num}<br>六点骰子:${eight_num}</div>
			<div class="col-xs-6">金币:${upObj.gold}<br>黄矿:${upObj.yellow}<br>绿矿:${upObj.green}<br>四点骰子:${upObj.four_num}<br>六点骰子:${upObj.eight_num}</div>
		`;
		//强化内容
		$("[txt_div]").html(str);
	}

	function init_up(){
		//获取当前强化等级
		weapon_lv = $("[weapon_up_lv]").attr("weapon_up_lv");
		weapon_lv = Number(weapon_lv);
		//获取强化精炼数据
		const upObj = upList[weapon_lv];
		if(upObj == null){
			return ;
		}
		up_num++;
		gold += upObj.gold;
		yellow += upObj.yellow;
		green += upObj.green;

		//当前等级大于5消耗8点
		if(weapon_lv < 5){
			four_num++;
		}else{
			eight_num++;
		}

		//第一次强化初始值
		if(probability === 0.000000){
			probability = upObj.probability;
		}

		//第一次强化初始值
		low_probability = upObj.low_probability;
		return upObj;
	}

</script>

</body>
</html>