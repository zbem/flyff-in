<!doctype html>
<html lang="en" xmlns="">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>飞瘾犯了-武器</title>
</head>


<link href="css/bootstrap.min.css?v=202404021835" rel="stylesheet" type="text/css">
<link href="css/style.css?v=202404021835" rel="stylesheet" type="text/css">
<link href="css/font-awesome.css?v=4.4.0" rel="stylesheet">
<!-- Morris -->
<link href="css/plugins/morris/morris-0.4.3.min.css" rel="stylesheet">
<!-- Gritter -->
<link href="js/plugins/gritter/jquery.gritter.css" rel="stylesheet">
<link href="css/animate.css" rel="stylesheet">

<body class="gray-bg">
<div class="wrapper wrapper-content">
	<div class="row">
		<div class="col-sm-4">
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>武器专区</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					<div class="feed-activity-list">
						<div class="media-body ">
							<div class="row" weapon_list></div>
						</div>
					</div>
				</div>
			</div>
			<div class="ibox float-e-margins"></div>
		</div>

		<div class="col-sm-4">
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>武器操作台</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">

					<div class="feed-activity-list">
						<div class="feed-element hide">
							<div class="media-body ">
								<img alt="image" src="img/items/genmateleearth.png">
								<img alt="image" src="img/items/genmateleeletri.png">
								<img alt="image" src="img/items/genmatelefire.png">
								<img alt="image" src="img/items/genmatelewater.png">
								<img alt="image" src="img/items/genmatelewind.png">
							</div>
						</div>

						<div class="feed-element">
							<div class="media-body ">
								<div class="form-group col-sm-3">
									<div class="input-group" >
										<input type="text" class="form-control" placeholder = "强化数字" input_weapon_up_num  maxlength="2" value="7"  ><br>
										<div class="input-group-btn open">
											<img alt="image"  src="img/items/syssysscrsmepro2.png" weapon_up onclick="weapon_low_up()">
										</div>
									</div>
								</div>
<!--								<img alt="image"  src="img/items/syssysscrpiepro.png">-->
<!--								<button class="btn btn-success" weapon_up onclick="weapon_low_up()" >穿洞</button>-->
							</div>
						</div>
						<div class="feed-element">
							<div class="media-body ">
								<img alt="image"  src="img/items/syssysscrsmepro.png">
								<button class="btn btn-success" weapon_up onclick="weapon_up()" >防暴</button>
								<img alt="image"  src="img/items/genmatorichalcum02.png">
								<button class="btn btn-success" weapon_up  onclick="up_u_weapon()" >升U</button>
								<img alt="image"  src="img/items/scrollskillawake.png">
								<button class="btn btn-success" weapon_up onclick="wake_up()" >技唤</button>

							</div>
						</div>
						<div class="feed-element">
							<div class="media-body ">
								<img alt="image"  src="img/skills/asschemental.png">
								<button class="btn btn-success" attribute_up onclick="attribute_wake_up_go(0)" >智唤</button>
								<img alt="image"  src="img/skills/asscheheapup.png">
								<button class="btn btn-success" attribute_up onclick="attribute_wake_up_go(1)" >体唤</button>
							</div>
						</div>
						<div class="feed-element">
							<div class="media-body ">
								<img alt="image"  src="img/skills/asschebeefup.png">
								<button class="btn btn-success" attribute_up onclick="attribute_wake_up_go(2)" >力唤</button>
								<img alt="image"  src="img/skills/asschecannon.png">
								<button class="btn btn-success" attribute_up onclick="attribute_wake_up_go(3)" >敏唤</button>
							</div>
						</div>
						<div class="feed-element">
							<div class="media-body ">
								<img alt="image"  src="img/items/syssysscrscroll01.png">
								<button class="btn btn-success" attribute_up onclick="attribute_wake_up()" >混唤</button>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="ibox float-e-margins">
				<div class="ibox float-e-margins">
					<div class="ibox-title">
						<h5>武器属性</h5>
						<div class="ibox-tools">
							<a class="collapse-link">
								<i class="fa fa-chevron-up"></i>
							</a>
						</div>
					</div>
					<div class="ibox-content">
						<div weapon-attributes></div>
					</div>
				</div>
			</div>

			<div class="ibox float-e-margins"></div>
		</div>

		<div class="col-sm-4">
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>消息</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					<div class="feed-activity-list">
						<div class="feed-element">
							<div class="media-body ">
								<div class="row" txt_div></div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="ibox float-e-margins"></div>
		</div>
	</div>
</div>

<!-- 全局js -->
<script src="js/jquery.min.js?v=2.1.4"></script>
<script src="js/bootstrap.min.js?v=3.3.6"></script>
<script src="js/base.js?v=202404020006"></script>
<!-- 自定义js -->
<script src="js/content.js?v=1.0.0"></script>
<!-- jQuery UI -->
<script src="js/plugins/jquery-ui/jquery-ui.min.js"></script>

<script>
	$(document).ready(function() {
		//页面元素可移动
		WinMove();

		// 当页面加载完成后，给 body 元素添加自定义光标样式
		$('body').addClass('custom-cursor');
	});

	let weapon_json_list = [];
	$.getJSON(`json/weapon.json`).success(function(data){
		weapon_json_list.push(data);

		$(data).each(function(i,obj){
			$("[weapon_list]").append(`
				<div class="col-xs-4" btn_weapon onclick="get_weapon_go(${obj.id})">
					<img src="img/items/${obj.icon}" alt="${obj.name.cns}">
				</div>
			`);
		});
	});

	function getRandomValues(array, numValues) {
		const values = [];
		for (let i = 0; i < numValues; i++) {
			values.push(array[Math.floor(Math.random() * array.length)]);
		}
		// 去除重复的值（如果需要）
		return [...new Set(values)];
	}

	const myArray = [0,1,2,3];
	//混乱属性唤醒
	function attribute_wake_up(){
		const weaponObj = data.find(obj => obj.id === parseInt(weapon_index));
		//没有武器
		if(weaponObj == null){
			return;
		}

		//随机数组中的1或2个值
		const numList = getRandomValues(myArray,2);
		if(numList.length === 2){
			attribute_wake_up_list(numList);
		}else{
			attribute_wake_up_go(numList[0]);
		}
	}

	//属性唤醒
	function attribute_wake_up_list(numList){
		$("[attribute_span]").remove();

		for(let j=0 ; j < numList.length ; j++) {
			let randomNum = Math.random().toFixed(2);
			//重置概率
			let attribute_probability = 0;
			//移除+4
			const new_attribute_data_list = attribute_data[numList[j]].list;
			for (let i = 0; i < new_attribute_data_list.length; i++) {
				const data = new_attribute_data_list[i];
				if (i > 0) {
					attribute_probability = parseFloat(data.probability) + parseFloat(attribute_probability);
				} else {
					attribute_probability = parseFloat(data.probability);
				}
				attribute_probability = attribute_probability.toFixed(2);

				//数字是否匹配
				if (randomNum < attribute_probability) {
					now_attribute = data.name;
					$("[job_span]").before(`
						<span attribute_span color_white>${attribute_data[numList[j]].name}${data.name === '+4' ? '+3' :data.name}<br></span>
					`);
					break;
				}
			}
		}
		const attribute_html = `${attribute_data[numList[0]].name}和${attribute_data[numList[1]].name}`;
		//武器属性唤醒值
		$("[attribute_name]").html(`${attribute_html}的`);

		if($(`[attribute_num_${attribute_html}]`) === null || $(`[attribute_num_${attribute_html}]`).length === 0){
			$("[txt_div]").prepend(`
				<div class="col-xs-6" >${attribute_html}</div><div class="col-xs-6" >次数:<span attribute_num_${attribute_html}>1</span></div>
			`);
		}else{
			let	attribute_num =  $(`[attribute_num_${attribute_html}]`).html();
			$(`[attribute_num_${attribute_html}]`).html(`${ parseInt(attribute_num)+1}`);
		}
	}

	//属性唤醒
	function attribute_wake_up_go(num){
		const weaponObj = data.find(obj => obj.id === parseInt(weapon_index));
		//没有武器
		if(weaponObj == null){
			return;
		}

		let randomNum = Math.random().toFixed(2);
		let attribute_probability = 0;

		$("[attribute_span]").remove();

		for(let i=0 ; i < attribute_data[num].list.length ; i++) {
			const data = attribute_data[num].list[i];
			if (i > 0) {
				attribute_probability = parseFloat(data.probability) + parseFloat(attribute_probability);
			} else {
				attribute_probability = parseFloat(data.probability);
			}
			attribute_probability = attribute_probability.toFixed(2);

			//数字是否匹配
			if (randomNum < attribute_probability) {
				now_attribute = data.name;
				$("[job_span]").before(`
					<span attribute_span color_white>${attribute_data[num].name}${data.name}<br></span>
				`);
				break;
			}
		}
		//武器属性值
		$("[attribute_name]").html(`${attribute_data[num].name}的`);

		const attribute_num_html =`attribute_num_${attribute_data[num].name}`;

		if($(`[${attribute_num_html}]`) === null || $(`[${attribute_num_html}]`).length === 0){
			$("[txt_div]").prepend(`
				<div class="col-xs-6" >${attribute_data[num].name}</div><div class="col-xs-6" >次数:<span ${attribute_num_html}>1</span></div>
			`);
		}else{
			let	attribute_num = $(`[${attribute_num_html}]`).html();
			$(`[${attribute_num_html}]`).html(`${ parseInt(attribute_num)+1}`);
		}
	}

	//升U
	function up_u_weapon(){
		// if(Number($("[weapon_up_lv]").attr("weapon_up_lv")) !== 10){
		// 	errorMsg("武器还没+10哦");
		// 	return;
		// }
		const weaponObj = data.find(obj => obj.id === parseInt(weapon_index));

		if(weaponObj == null){
			return;
		}

		$("[up_u_weapon_div]").remove();
		var arr = weaponObj.uList;
		var value1 = arr.splice(Math.floor(Math.random() * arr.length), 1)[0];
		var value2 = arr.splice(Math.floor(Math.random() * arr.length), 1)[0];

		var list = [];
		list.push(value1);
		list.push(value2);

		//还原数据
		arr.push(value1);
		arr.push(value2);

		let str = "<div up_u_weapon_div>";
		//组装属性值
		for(var i=0 ; i < list.length ; i++){
			var obj = list[i];
			var num = Math.floor(Math.random()*(obj.max-obj.min+1));
			var maxNum = obj.max;
			var minNum = obj.min;
			//最终计算出来的随机值
			var randomNum = obj.min + num;

			//缩进小数位
			maxNum = obj.fixed == null ? maxNum : (maxNum/obj.fixed);
			minNum = obj.fixed == null ? minNum : (minNum/obj.fixed);
			randomNum = obj.fixed == null ? randomNum : (randomNum/obj.fixed);

			//组装单位(例如 百分号)
			randomNum = randomNum+obj.cur;
			str +='<span style="color: #fffd43">'+ obj.name +'+' + randomNum + ' (' + minNum+'~'+maxNum+')'+obj.cur+'</span><br>';
		}

		str += "</div>";

		if($("[attribute_span]").length != 0){
			$("[attribute_span]").before(str);
		}else{
			$("[job_span]").before(str);
		}
	}

	//技能唤醒
	function wake_up(){
		if(wakeUpList == null){
			return ;
		}
		$("[wake_up]").remove();

		//随机数组中的值
		const wakeUp = wakeUpList[Math.floor(Math.random() * wakeUpList.length)];
		const percentage = wakeUp.item[Math.floor(Math.random() * wakeUp.item.length)];
		$("[weapon_description]").after('<div wake_up></br><span style="color: #fe0f7a;" >'+wakeUp.name+(wakeUp.name ==="治疗" ? '+' : ' 造成伤害+')+percentage+"%"+'</span></div>');
	}

	function weapon_up(){
		$("[weapon_up]").attr("disabled",true);
		if(weapon_up_stop){
			weapon_up_stop = false;
			$("[weapon_up]").removeAttr("disabled");
			return ;
		}
		if(Number($("[weapon_up_lv]").attr("weapon_up_lv")) !== 10){
			$("[txt_div]").html("");
		}

		weapon_up_go();
		setTimeout(function() {
			weapon_up();
		}, 50); // 1000毫秒等于1秒
	}
	function weapon_up_go(){
		//武器已经强化到+10啦
		if(Number($("[weapon_up_lv]").attr("weapon_up_lv")) === 10 || $("[weapon_up_lv]").length === 0){
			weapon_up_stop = true;
			return ;
		}
		weapon_up_num++;
		//初始化
		init_up();

		let str = '<hr>';
		// 生成一个0到1之间的随机数
		let randomNum = Math.random();
		//是否精炼成功
		if(randomNum <= probability){
			weapon_lv++;
			str+='<div class="col-xs-6" color_green>精炼+'+weapon_lv+'成功!<br></div>';

			if(weapon_lv !== 10){
				//成功后重置概率
				probability = upList[weapon_lv].probability;
			}
		}else {
			//获取强化精炼数据
			const upObj = upList[weapon_lv];
			//失败次数
			failure_num++;
			//失败累加基础强化概率
			probability = upObj.probability+probability;
			//成功概率不能大于1
			probability = probability >= 1 ? 1 : probability;
			str+="<div class='col-xs-6' color_red>精炼失败!<br></div>";
		}
		str+="<div class='col-xs-6'>当前成功率"+probability+"</div><hr>";
		//组装数据
		txt_div_prepend(str);
	}

	function weapon_low_up(){
		const low_num = $("[input_weapon_up_num]").val();
		if(low_num === null || low_num === '' || low_num.trim() ==='' ){
			$("[txt_div]").html(`<div class="col-xs-12">请输入强化等级!</div>`);
			return ;
		}

		$("[weapon_up]").attr("disabled",true);
		if(weapon_low_up_stop){
			weapon_low_up_stop = false;
			$("[weapon_up]").removeAttr("disabled");
			return ;
		}

		if(Number($("[weapon_up_lv]").attr("weapon_up_lv")) !== 10){
			$("[txt_div]").html("");
		}
		weapon_low_up_go(low_num);
		setTimeout(function() {
			weapon_low_up();
		}, 50); // 1000毫秒等于1秒
	}

	function weapon_low_up_go(num){
		//武器已经强化到+10啦
		if(Number($("[weapon_up_lv]").attr("weapon_up_lv")) === 10 || $("[weapon_up_lv]").length === 0){
			weapon_low_up_stop=true;
			$("[txt_div]").html(`<div class="col-xs-12">没有选择武器!</div>`);
			return ;
		}

		weapon_low_up_num++;

		//初始化
		init_up();

		let str = '<hr>';
		// 生成一个0到1之间的随机数
		let randomNum = Math.random();
		//是否精炼成功
		if(randomNum <= low_probability){
			//升级
			weapon_lv++;
			const now_weapon_lv = weapon_lv === 0 ? "" : ("+" + weapon_lv);
			str+='<div class="col-xs-6" color_green>low精炼'+now_weapon_lv+'成功!</div>';
		}else {
			//失败次数
			failure_num++;

			//+3以前失败不掉级
			if(weapon_lv > 3){
				//降级
				weapon_lv--;
				str+='<div class="col-xs-6" color_red>low精炼失败!掉级至+'+weapon_lv+'</div>';
			}else{
				str+='<div class="col-xs-6" color_red>low精炼失败!+3以前失败不掉级</div>';
			}
		}
		str+='<div class="col-xs-6">当前成功率'+low_probability+'</div><hr>';
		//组装数据
		txt_div_prepend(str);

		if(Number($("[weapon_up_lv]").attr("weapon_up_lv")) === num){
			weapon_low_up_stop=true;
		}
	}

	function txt_div_prepend(str){
		$("[weapon_up_lv]").html(weapon_lv === 0 ? "" : ("+"+weapon_lv));
		$("[weapon_up_lv]").attr("weapon_up_lv",weapon_lv);
		//获取强化精炼数据
		const upObj = upList[weapon_lv === 10 ? 9 : weapon_lv];

		str+=`
			<div class="col-xs-6">强化总次数:${up_num}</div><div class="col-xs-6">失败次数:${failure_num}</div>
			<div class="col-xs-6">low卷强化次数:${weapon_low_up_num}</div><div class="col-xs-6">防暴卷强化次数:${weapon_up_num}</div>
			<hr>
			<div class="col-xs-6">总共消耗</div><div class="col-xs-6">本次消耗</div>
			<div class="col-xs-6">金币:${gold}<br>黄矿:${yellow}<br>绿矿:${green}<br>四点骰子:${four_num}<br>六点骰子:${eight_num}</div>
			<div class="col-xs-6">金币:${upObj.gold}<br>黄矿:${upObj.yellow}<br>绿矿:${upObj.green}<br>四点骰子:${upObj.four_num}<br>六点骰子:${upObj.eight_num}</div>
		`;
		//强化内容
		$("[txt_div]").html(str);
	}

	function init_up(){
		//获取当前强化等级
		weapon_lv = $("[weapon_up_lv]").attr("weapon_up_lv");
		weapon_lv = Number(weapon_lv);
		//获取强化精炼数据
		const upObj = upList[weapon_lv];
		if(upObj == null){
			return ;
		}
		up_num++;
		gold += upObj.gold;
		yellow += upObj.yellow;
		green += upObj.green;

		//当前等级大于5消耗8点
		if(weapon_lv < 5){
			four_num++;
		}else{
			eight_num++;
		}

		//第一次强化初始值
		if(probability === 0.000000){
			probability = upObj.probability;
		}

		//第一次强化初始值
		low_probability = upObj.low_probability;
		return upObj;
	}

</script>

</body>
</html>