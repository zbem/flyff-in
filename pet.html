<!doctype html>
<html lang="en" xmlns="">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>飞瘾犯了-宠物</title>
</head>

<link href="css/bootstrap.min.css?v=202404020006" rel="stylesheet" type="text/css">
<link href="css/style.css?v=202404020006" rel="stylesheet" type="text/css">
<link href="css/font-awesome.css?v=4.4.0" rel="stylesheet">
<!-- Morris -->
<link href="css/plugins/morris/morris-0.4.3.min.css" rel="stylesheet">
<!-- Gritter -->
<link href="js/plugins/gritter/jquery.gritter.css" rel="stylesheet">
<link href="css/animate.css" rel="stylesheet">
<link href="js/layer/skin/default/layer.css" rel="stylesheet">
<link href="css/fly.css?v=4.1.0" rel="stylesheet">

<style>
	.scroll-content {
		position: absolute;
		white-space: nowrap;
		animation: scrollUpDown 1s linear forwards;
		width: 100%;
		text-align: center;
	}

	@keyframes scrollUpDown {
		0% {
			transform: translateY(100%);
			opacity: 1;
		}

		100% {
			transform: translateY(0);
			opacity: 0;
		}
	}
</style>


<body class="gray-bg">
<div class="wrapper wrapper-content">
	<div class="row">
		<div class="col-sm-6">
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>操作区</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					<div>
						<div class="feed-activity-list">
							<div class="feed-element">
								<div class="media-body ">
									<img alt="image" class="img-circle" src="img/items/petegg.png">
									<button class="btn btn-success" pet_btn onclick="incubate()" >孵化蛋</button>
								</div>
							</div>
							<div class="feed-element">
								<div class="media-body ">
									<img alt="image" class="img-circle" src="img/items/petbarbarylion01_01.png">
									<button class="btn btn-success" pet_btn onclick="pet_up()" >升级宠</button>
								</div>
							</div>
							<div class="feed-element">
								<div class="media-body ">
									<img alt="image" class="img-circle" src="img/items/petbadyreaper.png">
									<button class="btn btn-success" pet_btn onclick="sacrifice()" >献祭当前宠</button>
								</div>
							</div>
							<div class="feed-element">
								<div class="media-body ">
									<img alt="image" class="img-circle" src="img/items/eveeasteregg.png">
									<button class="btn btn-success" pet_btn onclick="one_pet()" >一键完美宠</button>
								</div>
							</div>
							<div class="feed-element">
								<div class="media-body ">
									<img alt="image" class="img-circle" src="img/items/petbarbarylion01_02.png">
									<button class="btn btn-success" pet_btn onclick="pet_show()" >洗宠物外观</button>

									<button class="btn btn-success" id="startButton"  >测试</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="ibox float-e-margins"></div>
		</div>

		<div class="col-sm-6">
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>消息</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					<div pet_msg_div class="row"></div>
				</div>
			</div>
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>成果</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					<div txt_div class="row"></div>
				</div>
			</div>
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>洗宠消息</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					<div show_pet_msg_div class="row"></div>
				</div>
			</div>
		</div>

		<div class="ibox float-e-margins"></div>
	</div>
</div>

<div class="hide">
	<img img_lv img_lv_1  src="img/pet/等级1.png" alt="1">
	<img img_lv img_lv_2 src="img/pet/等级2.png" alt="2">
	<img img_lv img_lv_3 src="img/pet/等级3.png" alt="3">
	<img img_lv img_lv_4 src="img/pet/等级4.png" alt="4">
	<img img_lv img_lv_5 src="img/pet/等级5.png" alt="5">
	<img img_lv img_lv_6 src="img/pet/等级6.png" alt="6">
	<img img_lv img_lv_7 src="img/pet/等级7.png" alt="7">
	<img img_lv img_lv_8 src="img/pet/等级8.png" alt="8">
	<img img_lv img_lv_9 src="img/pet/等级9.png" alt="9">
	<img alt="兔子" img_兔子 src="img/pet/兔子.png">
	<img alt="天使" img_天使 src="img/pet/天使.png">
	<img alt="帝王蟹" img_帝王蟹 src="img/pet/帝王蟹.png">
	<img alt="狐狸" img_狐狸 src="img/pet/狐狸.png">
	<img alt="独角兽" img_独角兽 src="img/pet/独角兽.png">
	<img alt="狮子" img_狮子 src="img/pet/狮子.png">
	<img alt="狮鹫兽" img_狮鹫兽 src="img/pet/狮鹫兽.png">
	<img alt="老虎" img_老虎 src="img/pet/老虎.png">
	<img alt="飞龙" img_飞龙 src="img/pet/飞龙.png">
</div>

<div class="scroll-content">
	<span style=" color: red">你随机到了相同或较低等级，因此无事发生。</span>
</div>

<!-- 全局js -->
<script src="js/jquery.min.js?v=2.1.4"></script>
<script src="js/bootstrap.min.js?v=3.3.6"></script>
<script src="js/base.js?v=202404020006"></script>
<!-- 自定义js -->
<script src="js/content.js?v=1.0.0"></script>
<!-- jQuery UI -->
<script src="js/plugins/jquery-ui/jquery-ui.min.js"></script>
<script src="js/layer/layer.js"></script>

<script>
	$(document).ready(function() {
		//页面元素可移动
		WinMove();

		// 当页面加载完成后，给 body 元素添加自定义光标样式
		$('body').addClass('custom-cursor');

		// 假设你有一个按钮来触发动画
		$('#startButton').click(function() {
			$('#scrollMessage').css({
				'animation': 'scroll 5s linear forwards, fadeOut 5s ease-out forwards 5s'
			});
		});
	});

	//洗外观
	function pet_show(){
		if($("[now_pet_img]") == null || $("[now_pet_img]").length === 0){
			alert("没有宠物");
			return ;
		}

		const pet_box = blindBox().drawItem();

		$("[now_pet_img]").attr("src","img/items/"+pet_box.name);
		$("[now_pet_img]").attr("alt",pet_box.id);
	}

	function blindBox() {
		//次数
		pet_box_num++;
		const totalItems = 28;
		const lowProbabilityItem = [0,1,2,3,4,5]; // 低概率物品索引
		const lowProbability = 0.005; // 低概率物品被抽中的概率

		// 计算其他物品的平均概率
		const averageProbability = (1 - lowProbability*lowProbabilityItem.length) / (totalItems - lowProbabilityItem.length);

		// 创建一个数组来存储每个物品及其对应的概率
		const items = Array.from({ length: pet_file_list.length }, (_, index) => {
			if (lowProbabilityItem.includes(index)) {
				return { id: index+1, probability: lowProbability,name:pet_file_list[index] };
			} else {
				return { id: index+1, probability: averageProbability,name:pet_file_list[index] };
			}
		});

		// 抽选物品的函数
		function drawItem() {
			let item_probability = 0;
			for (let i = 0; i < items.length; i++) {
				if(i > 0){
					item_probability = parseFloat(items[i].probability) + parseFloat(item_probability);
				}else{
					item_probability = parseFloat(items[i].probability);
				}
				item_probability = item_probability.toFixed(2);
				// 生成一个0到1之间的随机数
				let randomNum = Math.random().toFixed(2);

				//数字是否匹配
				if(randomNum < item_probability){
					item_probability = (item_probability*100).toFixed(2);
					if(lowProbabilityItem.includes(i)){
						//洗出了稀有宠
						$("[show_pet_msg_div]").prepend(`
						<div class="col-xs-12" >
							<img style="width: 30px; height: 30px;" alt="${items[i].id}" src="img/items/${items[i].name}">第${pet_box_num}次洗出了稀有宠,概率:${item_probability}%
						</div>`);
					}else{
						//洗了几次
						$("[show_pet_msg_div]").prepend(`
						<div class="col-xs-12" >
							<img style="width: 30px; height: 30px;" alt="${items[i].id}" src="img/items/${items[i].name}">第${pet_box_num}次,概率:${item_probability}%
						</div>`);
					}

					return items[i];
				}
			}
		}

		return {
			items: items.map(item => item.id), // 返回物品ID数组，用于展示或其他用途
			drawItem: drawItem // 返回抽选物品的函数
		};
	}


	//一键献祭
	function one_pet(){
		//孵化宠
		incubate();
		//宠物升级
		pet_up_go();
	}

	function pet_up_go(){
		//宠物升级
		pet_up();
		//献祭
		sacrifice_go();
	}

	function sacrifice_go(){
		if(pet_up_stop && sacrifice_stop){
			sacrifice_stop = false;
			pet_up_stop = false;
			return ;
		}

		if(sacrifice_stop){
			sacrifice_stop = false;
			pet_up_go()
			return ;
		}
		//献祭
		sacrifice();
		sacrifice_go();
	}

	//孵化蛋
	function incubate(){
		$("[txt_div]").html("");
		$("[pet_msg_div]").html("");
		//献祭次数清0
		pet_num = 0;
		//随机数组中的值
		const pet = incubate_pet[Math.floor(Math.random() * incubate_pet.length)];
		//当前宠物
		now_pet = pet;

		let str = `
			<div class="alert alert-info" pet_info  pet_lv="0" >
				<div class="row">
					<div class="col-xs-12" ><span style="color: #da6443">${pet.name}</span></div><br>
					<div class="col-xs-5" ><img style="width: 80px; height: 70px;" now_pet_img alt="${pet.name}" img_${pet.name} src="img/pet/${pet.name}.png"></div>
					<div class="col-xs-7">等级:<span style="color: #fb37b1" pet_lv_str>F级</span></div><br>
					<div class="col-xs-7">属性:<span style="color: #fb37b1" >${pet.attributeStr}+</span><span pet_value>${pet.value}</span><span pet_cur>${pet.cur}</span></div>
				</div>
				<div class="row">
					<div pet_img_div><label lv_f级 pet_val="${pet.value}"><img img_lv img_lv_1  src="img/pet/等级1.png" alt="1"><br>+${pet.value}${pet.cur}</label></div>
				</div>
			</div>
		`;
		$("[txt_div]").prepend(str);
	}

	//宠物升级
	function pet_up(){
		//献祭次数清0
		pet_num = 0;
		pet_lv = $("[pet_lv]").attr("pet_lv");
		if(pet_lv == null || pet_lv >= 6){
			sacrifice_stop = true;
			pet_up_stop = true;
			return;
		}
		const pet = pet_lv_item[pet_lv];

		// 生成一个0到1之间的随机数
		let randomNum = Math.random().toFixed(2);

		let pet_probability =0;

		for(let i=0 ; i < pet.list.length ; i++) {
			if(i > 0){
				pet_probability = parseFloat(pet.list[i].probability) + parseFloat(pet_probability);
			}else{
				pet_probability = parseFloat(pet.list[i].probability);
			}
			pet_probability = pet_probability.toFixed(2);

			//数字是否匹配
			if(randomNum < pet_probability){
				now_lv = pet.list[i].pet_lv;
				const pet_lv_value = now_pet.value_list[pet.list[i].pet_lv - 1];

				const img_html = $("[img_lv_"+pet.list[i].pet_lv+"]")[0].outerHTML;

				$("[pet_img_div]").append(`<label lv_${pet_lv_item[Number(pet_lv)+1].lvStr} pet_val="${pet_lv_value}">${img_html}<br>+${pet_lv_value+now_pet.cur}</label>`);
				break;
			}
		}

		$("[pet_lv_str]").html(pet_lv_item[Number(pet_lv)+1].lvStr);
		pet_lv++;
		$("[pet_lv]").attr("pet_lv",pet_lv);

		let now_pet_value = 0;
		$("[pet_val]").each(function(){
			now_pet_value+= parseInt($(this).attr("pet_val"));
		});

		//属性更新
		$("[pet_value]").html(now_pet_value);
	}

	//献祭
	function sacrifice(){
		pet_lv = $("[pet_lv]").attr("pet_lv");
		if(pet_lv == null || pet_lv === 0){
			sacrifice_stop = true;
			return;
		}

		//s级 继续洗
		if(pet_lv > 6){
			pet_lv = 6;
		}
		const pet = pet_lv_item[pet_lv];
		if(now_lv >= pet.list.length){
			sacrifice_stop = true;
			layer.msg("已经是最高的等级!",{time:2000,skin:"layer_msg_s"});
			return;
		}

		// 生成一个0到1之间的随机数
		let randomNum = Math.random().toFixed(2);
		let pet_probability = 0;

		//是否成功
		let is_suc = false;

		for(var i=0 ; i <= pet.list.length ; i++) {
			const lv = pet.list[i].pet_lv;
			if(lv <= now_lv){
				break;
			}

			if(i > 0){
				pet_probability = parseFloat(pet.list[i].probability) + parseFloat(pet_probability);
			}else{
				pet_probability = parseFloat(pet.list[i].probability);
			}
			pet_probability = pet_probability.toFixed(2);

			//数字是否匹配
			if(randomNum < pet_probability){
				now_lv = lv;
				$("[lv_"+pet.lvStr+"]").remove();
				var pet_lv_value =now_pet.value_list[pet.list[i].pet_lv-1];
				$("[pet_img_div]").append('<label lv_'+pet.lvStr+' pet_val="'+pet_lv_value+'"><img img_lv src="img/pet/等级'+pet.list[i].pet_lv+'.png" alt="等级"><br>+'+pet_lv_value+now_pet.cur+'</label>');

				is_suc = true;
				break;
			}
		}

		if(is_suc){
			layer.msg("你的宠物提升到了新的，更高的等级!",{time:2000,skin:"layer_msg_s"});
		}else{
			layer.msg("你随机到了相同或较低等级，因此无事发生。",{time:2000,skin:"layer_msg_f"});
		}


		//献祭次数
		pet_num++;
		$("[pet_"+pet.lvStr+"]").remove();

		let html_money = parseFloat(pet.money*0.00000026).toFixed(2);
		//统计数据
		$("[pet_msg_div]").append('<div class="col-xs-12" pet_'+pet.lvStr+' >'+pet.money+'金币/次,'+html_money+'元/次</br>'+pet.lvStr+'献祭次数:'+pet_num+'</div>');

		let now_pet_value = 0;
		$("[pet_val]").each(function(){
			now_pet_value+= parseInt($(this).attr("pet_val"));
		});

		//属性更新
		$("[pet_value]").html(now_pet_value);
	}
</script>

</body>
</html>