<!doctype html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>飞瘾犯了</title>
</head>

<body>

<script src="js/jquery.min.js?v=202404020006"></script>
<script src="js/base.js?v=202404020006"></script>
<script src="js/bootstrap.min.js?v=202404020006"></script>
<link href="css/bootstrap.min.css?v=202404020006" rel="stylesheet" type="text/css">
<link href="css/style.css?v=202404020006" rel="stylesheet" type="text/css">

<div class="container" style="padding-top: 20px;border: 1px solid;" >
	<div class="row" >
		<div class="col-xs-3 pull-left">
			<div class="row">
				<div class="col-xs-12">
					<input type="text" class="form-control" keyword onblur="find_item()" maxlength="30" placeholder="id/怪物名称/物品名称" name="position"/>
				</div>
			</div>
			<hr>
			<div class="row">
				<div class="col-xs-6">
					<button class="btn btn-success" onclick="init_model()" >召唤看板娘</button>
				</div>
			</div>
			<hr>
			<div class="row">
				<div class="col-xs-6">
					<button class="btn btn-success" onclick="clear_div()" >清空信息</button>
				</div>
			</div>
			<hr>
			<div class="row hide" show_time>
				<div style="font-size: 20px;color: #ffffff;">时装达人秀</div>
				<div class="ibox float-e-margins">
					<div class="ibox-content">
						<div class="carousel slide" id="carousel1">
							<div class="carousel-inner">
								<div class="item active">
									<img class="img-responsive" style="width: 300px;height: 320px" src="img/show/可爱的小游.png" alt="可爱的小游">
								</div>
							</div>
							<a data-slide="prev" href="#carousel1" class="left carousel-control">
								<span class="icon-prev"></span>
							</a>
							<a data-slide="next" href="#carousel1" class="right carousel-control">
								<span class="icon-next"></span>
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="col-xs-9" right_msg_div >
			<div txt_div class="row"></div>
		</div>
	</div>
	<div class="waifu hide">
		<div class="waifu-tips"></div>
		<canvas id="live2d" width="280" height="250" class="live2d"></canvas>
		<div class="waifu-tool">
			<span class="fui-home"></span>
			<span class="fui-chat"></span>
			<span class="fui-eye"></span>
			<span class="fui-user"></span>
			<span class="fui-photo"></span>
			<span class="fui-info-circle"></span>
			<span class="fui-cross"></span>
		</div>
	</div>
</div>

<script>

	let item_json_list = [];
	let monster_json_list = [];

	$(json_items).each(function (i, obj) {
		$.getJSON(`json/item/${obj}`).success(function(data){
			item_json_list.push(data);
		});
		$.getJSON(`json/monster/${obj}`).success(function(data){
			monster_json_list.push(data);
		});
	});

	function init_model(){
		// 加载 CSS
		$("<link>").attr({href: "waifu/assets/waifu.css", rel: "stylesheet", type: "text/css"}).appendTo('head');

		// 加载 JS
		$.ajax({
			url: 'waifu/assets/waifu-tips.js',
			dataType:"script",
			cache: true,
			async: false
		});
		$.ajax({
			url: 'waifu/assets/live2d.js',
			dataType:"script",
			cache: true,
			async: false
		});

		$(".waifu").removeClass("hide");
		initModel('waifu/assets/');
	}

	$(document).ready(function() {
		// 当页面加载完成后，给 body 元素添加自定义光标样式
		$('body').addClass('custom-cursor');

	});

	function find_item(){
		$("[txt_div]").html("");

		const keyword = $("[keyword]").val();
		if(keyword.trim() === ""){
			return ;
		}

		$(item_json_list.flat()).each(function(e,item){
			if($("[json_id_"+item.id+"]").length !== 0){
				return ;
			}

			if (item.name != null && item.name.cns != null && item.name.cns.includes(keyword) || item.id === parseInt(keyword)) {
				const color_str = 'style="color:' + (item.rarity === 'common' ? '#78d9ff' : item.rarity === 'uncommon' ? '#c46200' : item.rarity === 'veryrare' || item.rarity === 'unique' ? '#d20000' : item.rarity === 'probability' ? 'green' : '') + '"';
				$("[txt_div]").append(`
				<div class="col-xs-12" json_id_${item.id} >
					<img src="img/items/${item.icon}" style="width: 20px; height: 20px;" alt="${item.name.cns}">
					<span ${color_str}>${item.id}---${item.name.cns}</span><br>
					<span>id:${item.id}</span><br>
					<span>名称:${item.name.cns}</span><br>
					<span>描述:${item.description.cns}</span><br>
					<span>当前等级:${item.level}</span><br>
					<span>${JSON.stringify(item)}</span>
				</div>
				`);
			}
		});
		$(monster_json_list.flat()).each(function(e,item){
			if($("[json_id_"+item.id+"]").length !== 0){
				return ;
			}

			if (item.name != null && item.name.cns != null && item.name.cns.includes(keyword)) {
				const color_str = 'style="color:' + (item.rarity === 'common' ? '#78d9ff' : item.rarity === 'uncommon' ? '#c46200' : item.rarity === 'veryrare' || item.rarity === 'unique' ? '#d20000' : item.rarity === 'probability' ? 'green' : '') + '"';
				$("[txt_div]").append(`
				<div class="col-xs-12" json_id_${item.id} >
					<img src="img/monster/${item.icon}" style="width: 20px; height: 20px;" alt="${item.name.cns}">
					<span ${color_str}>${item.id}---${item.name.cns}</span><br>
				</div>
				`);
			}
		});
	}


</script>

</body>
</html>