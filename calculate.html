<!doctype html>
<html lang="en" xmlns="">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>飞瘾犯了-计算</title>
</head>

<link href="css/bootstrap.min.css?v=202404020006" rel="stylesheet" type="text/css">
<link href="css/font-awesome.css?v=4.4.0" rel="stylesheet">
<link href="css/plugins/chosen/chosen.css" rel="stylesheet">


<link href="css/style.css?v=4.1.0" rel="stylesheet">
<link href="css/fly.css?v=4.1.0" rel="stylesheet">

<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
	<div class="row">
		<div class="col-sm-6">
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5 msg_title>操作区</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					<div class="row">
						<div class="form-group col-sm-4">
							<label>副本<br>
								<select class="form-control" sel_dungeon style="min-width: 200px" >
									<option value="">请选择副本</option>
								</select>
							</label>
						</div>
						<div class="form-group col-sm-4">
							<label>人数<br>
								<select class="form-control" sel_num style="min-width: 200px">
									<option value="">请选择人数</option>
									<option value="1">1</option>
									<option value="2">2</option>
									<option value="3">3</option>
									<option value="4">4</option>
									<option value="5">5</option>
									<option value="6">6</option>
									<option value="7">7</option>
									<option value="8">8</option>
								</select>
							</label>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12 form-group" dungeon_buff >
						</div>
					</div>
				</div>
			</div>

			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>分红物品</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content" item_div>

				</div>
			</div>

			<div class="ibox float-e-margins"></div>
		</div>

		<div class="col-sm-6">
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>人员</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content" calculate_div>
				</div>
			</div>

			<div class="ibox float-e-margins hide">
				<div class="ibox-title">
					<h5>消耗</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					<div class="row" sel_item>
					</div>
				</div>
			</div>

			<div class="ibox float-e-margins"></div>
		</div>

	</div>
</div>

<!-- 全局js -->
<script src="js/jquery.min.js?v=202404111603"></script>
<script src="js/bootstrap.min.js?v=3.3.6"></script>
<script src="js/base.js?v=202404111603"></script>

<!-- Chosen -->
<script src="js/plugins/chosen/chosen.jquery.js"></script>

<!-- 自定义js -->
<script src="js/content.js?v=1.0.0"></script>
<!-- jQuery UI -->
<script src="js/plugins/jquery-ui/jquery-ui.min.js"></script>

<script>
	$(document).ready(function() {
		//页面元素可移动
		WinMove();

		// 当页面加载完成后，给 body 元素添加自定义光标样式
		$('body').addClass('custom-cursor');

		const config = {
			'.chosen-select': {},
			'.chosen-select-deselect': {
				allow_single_deselect: true
			},
			'.chosen-select-no-single': {
				disable_search_threshold: 10
			},
			'.chosen-select-no-results': {
				no_results_text: 'Oops, nothing found!'
			},
			'.chosen-select-width': {
				width: "95%"
			}
		};
		for (const selector in config) {
			$(selector).chosen(config[selector]);
		}

		$("[sel_num]").on('change',add_calculate);

		get_cookie_json();
	});

	function get_cookie_json(){
		// 获取cookie的值
		const cookieValue = document.cookie.split('; ').find(row => row.startsWith('flyffData='));

		// 如果找到了cookie的值，则解码并解析JSON数据
		if (cookieValue) {
			const decodedString = decodeURIComponent(cookieValue.split('=')[1]);
			const json_data = JSON.parse(decodedString);
			console.log(json_data); // 输出：{ name: "John Doe", age: 30, email: "johndoe@example.com" }

			$("[sel_dungeon]").val(json_data.sel_dungeon).trigger('change');
			$("[sel_num]").val(json_data.sel_num).trigger('change');
			$("[msg_title]").html(json_data.title_str);

			for (let i = 0; i < json_data.list.length; i++) {
				const obj = json_data.list[i];
				$(`[job_${i}] select`).val(obj.job);
				$(`[job_${i}] [input_game_name]`).val(obj.name);
			}

			for (let i = 0; i < json_data.buff.length; i++) {
				const obj = json_data.buff[i];
				$(`[dungeon_buff] [value = "${obj}"]`).prop("checked","true");
			}

			for (let i = 0; i < json_data.item_list.length; i++) {
				const obj = json_data.item_list[i];
				$(`[item_div]`).prepend(`
					<span>${obj.name}:数量${obj.num}</span><br>
				`);
			}
		}
	}

	$.getJSON(`json/receive.json`).success(function(data){
		for(let i = 0 ; i < data.length ; i++){
			const obj = data[i];
			$("[sel_item]").append(`<div class="col-sm-4" style="padding-bottom: 5px;"><img src="img/items/${obj.icon}" alt="${obj.name.cns}" />${obj.name.cns}</div>`);
		}
	});

	for(let i = 0 ; i < dungeon_data_list.length ; i++){
		const obj = dungeon_data_list[i];
		$("[sel_dungeon]").append(`
			<option value="${obj.id}" >${obj.name}</option>
		`);
	}

	$("[sel_dungeon]").on("change",function (){
		$("[dungeon_buff]").html("");

		const dungeon_id = $("[sel_dungeon]").val();
		const dungeon_buff = dungeon_data_list.filter(e=>e.id === dungeon_id)[0].buff;

		for(let i = 0 ; i < dungeon_buff.length ; i++) {
			const obj = dungeon_buff_list.filter(e=>e.id.toString() === dungeon_buff[i].toString())[0];

			$("[dungeon_buff]").append(`
				<div class="checkbox" >
					<label >
						<input type="checkbox" value="${obj.id}" >
						<span style="font-weight: bold;">${obj.name}</span><br>
						${obj.description}<br>
						副本币*${obj.num}
					</label>
				</div>
			`);
		}
	});

	for (let i = 0; i < 8; i++) {
		$("[calculate_div]").append(`
				<div class="row">
					<div class="form-group col-sm-4" job_div job_${i}>
						<div class="input-group">
						<span class="input-group-addon" style="width: 81px;" >职业:</span>
						<select data-placeholder="请选择职业" class="form-control"  sel_job style="min-width: 100px" >
						 <option value="骑士" selected>骑士</option>
						 <option value="刀锋" >刀锋</option>
						 <option value="守护" >守护</option>
						 <option value="暴力" >暴力</option>
						 <option value="元素" >元素</option>
						 <option value="精神" >精神</option>
						 <option value="游侠" >游侠</option>
						 <option value="暗杀" >暗杀</option>
						</select>
					   </div>
					</div>
					<div class="form-group col-sm-4" job_div job_${i}>
					   <div class="input-group">
						<span class="input-group-addon" style="width: 81px;" >游戏昵称:</span>
						<input type="text" class="form-control" input_game_name >
					   </div>
					</div>
				</div>
			`);
	}

	function add_calculate() {
		const sel_num = $("[sel_num]").val();
		$('[job_div]').addClass("hide");
		for (let i = 0; i < sel_num; i++) {
			 $(`[job_${i}]`).removeClass("hide");
		}
	}

</script>

</body>
</html>